!function(){"use strict";var defaults,methodsMapping;defaults={partnerKey:"1-234-567-890",sponsor:"direct",baseURLPattern:"https://{{sponsor}}.api.titletoolbox.com/",debug:!1,sdkPrefix:"ttb-sdk",autoFillAttr:"data-ttb-field",modalTemplate:['<div id={{modalId}} class="ttb-sdk-modal modal" role="dialog">',' <div class="modal-dialog {{sizeClass}}">','  <div class="modal-content">','   <div class="modal-header">','    <button type="button" class="close" data-dismiss="modal" title="Close">&times;</button>','    <h4 class="modal-title">{{title}}</h4>',"   </div>",'   <div class="modal-body">',"    {{bodyContent}}","   </div>","  </div>"," </div>","</div>"].join("")},methodsMapping={LOGIN:{methodName:"login",endpoint:"webservices/login.json"},LOGIN_REMOTE:{methodName:"loginRemote",endpoint:"webservices/remote_login.json"},LOGOUT:{methodName:"logout",endpoint:"webservices/logout.json"},GET_SPONSORS:{methodName:"TTB.getSponsors",endpoint:"webservices/get_sponsors.json"},SEARCH_PARCEL:{methodName:"searchByParcelNumber",endpoint:"webservices/search_parcel_number.json"},SEARCH_PROPERTY:{methodName:"searchBySiteAddress",endpoint:"webservices/search_property/ttb.json"},SEARCH_OWNER:{methodName:"searchByOwnerName",endpoint:"webservices/search_owner_name/ttb.json"},ORDER_REPORT:{methodName:"orderReport",endpoint:"webservices/order_report.json"},PROPERTY_COMPS:{methodName:"propertyComps",endpoint:"webservices/property_comps.json"},PROPERTY_DETAILS:{methodName:"propertyDetails",endpoint:"webservices/property_details.json"},GLOBAL_SEARCH:{methodName:"globalSearch",endpoint:"webservices/global_search.json"},GLOBAL_SEARCH_COUNT:{methodName:"globalSearchCount",endpoint:"webservices/global_search_count.json"},GET_TYPES_REPORT:{methodName:"getTypesReport",endpoint:"webservices/types_report.json"},GET_SEARCH_FIELDS:{methodName:"getSearchFields",endpoint:"webservices/get_search_fields.json"}},window.TTB=function(e){this.config=e,this.baseURLPattern=e.baseURLPattern||defaults.baseURLPattern,this.sponsor=e.sponsor||defaults.sponsor,this.baseURL=e.baseURL||this.setSponsor(this.sponsor),this.autoFillAttr=e.autoFillAttr||defaults.autoFillAttr,this.debug=e.debug||defaults.debug,this._log([defaults.sdkPrefix+" :","TTB SDK instantiated."])},window.TTB._modal=function(e){var t,o;return e.id=e.id||Date.now()+"",e.sizeClass=e.sizeClass||"modal-lg",o=defaults.modalTemplate.replace("{{modalId}}",e.id).replace("{{sizeClass}}",e.sizeClass).replace("{{title}}",e.title).replace("{{bodyContent}}",e.bodyContent),t=$(o).appendTo(document.body),e.onBeforeShow&&t.on("show.bs.modal",e.onBeforeShow),e.onShown&&t.on("shown.bs.modal",e.onShown),e.onBeforeClose&&t.on("hide.bs.modal",e.onBeforeClose),e.onClose&&t.on("hidden.bs.modal",e.onClose),t},window.TTB.getSponsors=function(e){var t=new TTB({partnerKey:defaults.partnerKey}),o={method:"POST",data:JSON.stringify(e)};return t._ajax(o,methodsMapping.GET_SPONSORS)},window.TTB.showSelectSponsor=function(e,t){var o,s;return o="ttb-sdk-sponsor-selector",$("#"+o).length&&$("#"+o).remove(),s=this._modal({id:o,title:"Select Sponsor",bodyContent:"Retrieving list of all available sponsors..."}),TTB.getSponsors(e).done(function(a){var n;n={sponsorsData:void 0,bodyTemplate:void 0,bodyMarkup:void 0,sponsorTemplate:void 0,sponsorMarkup:void 0,sponsorsEmailMarkup:void 0,sponsorsZipMarkup:void 0,resultsMessage:void 0},"OK"===a.response.status?(n.sponsorsData=a.response.data,n.bodyMarkup=[],n.sponsorsEmailMarkup=[],n.sponsorsZipMarkup=[],n.sponsorTemplate=["<tr>"," <td>{{count}}</td>",' <td><img src="{{logoUrl}}" class="img-responsive" alt="Sponsor Logo"></td>'," <td>{{name}}</td>",' <td><a href="{{website}}" target="_blank">{{website}}</a></td>',' <td><button class="btn btn-primary pull-right" data-sponsor="{{sponsor}}">Select</button></td>',"</tr>"].join(""),n.bodyTemplate=["<p>{{resultsMessage}}</p>",'<div class="table-responsive">','<table class="table table-striped">',"<thead>","<tr>","<th>#</th>","<th>LOGO</th>","<th>NAME</th>","<th>WEBSITE</th>","<th></th>","</tr>","<thead>","<tbody>{{sponsorsMarkup}}</tbody>","<table>","</div>"].join(""),$.each(n.sponsorsData,function(e,t){switch(n.sponsorMarkup=n.sponsorTemplate.replace("{{count}}",e+1).replace("{{logoUrl}}",t.company_info.logo_url).replace("{{name}}",t.company_info.company_name).replace(/(\{\{website}})/g,t.company_info.company_website).replace("{{sponsor}}",t.vertical_name),t.match.type){case"email":n.sponsorsEmailMarkup.push(n.sponsorMarkup);break;case"zip":n.sponsorsZipMarkup.push(n.sponsorMarkup);break;default:console.log("showSelectSponsor: unknown match.type: ",t.match.type)}}),n.sponsorsEmailMarkup.length&&(1===n.sponsorsData.length&&"leads"===n.sponsorsData[0].vertical_name?n.resultsMessage="There is no title company is available in your area. The data will be proudly sponsored by Benutech Inc.":n.resultsMessage="It looks like you already have an account with the following {{totalSponsors}} sponsor(s).".replace("{{totalSponsors}}",n.sponsorsEmailMarkup.length),n.bodyMarkup.push(n.bodyTemplate.replace("{{resultsMessage}}",n.resultsMessage).replace("{{sponsorsMarkup}}",n.sponsorsEmailMarkup.join("")))),n.sponsorsZipMarkup.length&&(n.sponsorsEmailMarkup.length&&n.bodyMarkup.push("<hr>"),n.resultsMessage="{{totalSponsors}} sponsors available serving your zipcode of <strong>{{zipCode}}</strong>.".replace("{{totalSponsors}}",n.sponsorsZipMarkup.length).replace("{{zipCode}}",e.zipCode),n.bodyMarkup.push(n.bodyTemplate.replace("{{resultsMessage}}",n.resultsMessage).replace("{{sponsorsMarkup}}",n.sponsorsZipMarkup.join("")))),s.find(".modal-dialog").css({width:"760px"}).find(".modal-body").html(n.bodyMarkup.join("")),$("#"+o+" tbody").on("click","button",function(e){var o=$(this).attr("data-sponsor");t.onSelect&&t.onSelect(o),s.modal("hide")})):t.onError&&t.onError(a)}).fail(function(e){s.find(".modal-body").html("Failed in retrieving list."),t.onError&&t.onError(e)}),s.modal({})},window.TTB.prototype={_log:function(e){this.config.debug&&console.log.apply(console,e)},_fillFields:function(selector,data){var _self,$fields,model,modelValue;_self=this,$fields=$(selector).find("input["+_self.autoFillAttr+"]"),$fields.each(function(){model=$(this).attr(_self.autoFillAttr);try{modelValue=eval("data."+model),$(this).val(modelValue)}catch(e){_self._log([defaults.sdkPrefix," : autoFill : skipping : invalid model - ",model])}})},_fillField:function(e,t,o){var s;(s=$(e).find("input["+this.autoFillAttr+'="'+t+'"]')).length?s.val(o):this._log([defaults.sdkPrefix," : autoFill : skipping : field not found - ",t])},_ajax:function(e,t,o){var s,a;return s=this,e.url=e.url||this.baseURL+t.endpoint,e.url=o?e.url+"?"+$.param(o):e.url,a=$.extend(e,{headers:{"Partner-Key":this.config.partnerKey,"Third-Party":!0},xhrFields:{withCredentials:!0}}),$.ajax(a).done(function(e){return"string"==typeof e||e instanceof Array||"OK"===e.response.status?s._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": success :",e]):s._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": error :",e]),e}).fail(function(e){return s._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": fail :",e]),401===e.status&&s.config.onSessionExpire&&s.config.onSessionExpire({requestConfig:a,requestError:e,methodName:t.methodName,endpoint:t.endpoint,retry:function(){return $.ajax(a)}}),e})},setSponsor:function(e){return this.baseURL=this.baseURLPattern.replace("{{sponsor}}",e)},loginRemote:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.LOGIN_REMOTE)},login:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.LOGIN)},logout:function(){return this._ajax({method:"GET"},methodsMapping.LOGOUT)},searchByParcelNumber:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_PARCEL)},searchBySiteAddress:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_PROPERTY)},searchByOwnerName:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_OWNER)},orderReport:function(e){e.output=e.output||"link",e.report_type=e.report_type||"property_profile";var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.ORDER_REPORT)},propertyComps:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.PROPERTY_COMPS)},propertyDetails:function(e,t){var o;o=this,t=t||{autoFillContext:null};var s={method:"POST",data:JSON.stringify(e)};return this._ajax(s,methodsMapping.PROPERTY_DETAILS).then(function(e){return t.autoFillContext&&o._fillFields(t.autoFillContext,e.response.data),e})},globalSearch:function(e,t){var o={method:"POST",data:JSON.stringify(e)};return this._ajax(o,methodsMapping.GLOBAL_SEARCH,t)},globalSearchCount:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.GLOBAL_SEARCH_COUNT)},nearbySearch:function(e,t){var o={limit:e.limit||1e3,page:1},s={mm_fips_state_code:e.mm_fips_state_code,use_code_std:["RSFR","RCON"],customFilters:{},searchOptions:{max_limit:e.limit||void 0},geometry:{match:"circle",value:{center_lat:e.center_lat,center_lng:e.center_lng,radius:e.radius}}};s=$.extend(s,t);var a={method:"POST",data:JSON.stringify(s)};return this._ajax(a,methodsMapping.GLOBAL_SEARCH,o)},getTypesReport:function(){return this._ajax({method:"GET"},methodsMapping.GET_TYPES_REPORT)},getSearchFields:function(){return this._ajax({method:"GET"},methodsMapping.GET_SEARCH_FIELDS)},googleBuildAddress:function(e,t){var o,s,a,n,r;s={};for(var i={street_number:{field_name:"site_street_number",name_type:"short_name"},route:{field_name:"site_route",name_type:"short_name"},locality:{field_name:"site_city",name_type:"long_name"},administrative_area_level_1:{field_name:"site_state",name_type:"short_name"},administrative_area_level_2:{field_name:"site_county",name_type:"short_name"},postal_code:{field_name:"site_zip",name_type:"short_name"}},l=0,d=(o=e.getPlace()).address_components.length;l<d;l++)i[n=(a=o.address_components[l]).types[0]]&&(r=a[i[n].name_type],s[i[n].field_name]=r,t.autoFillContext&&this._fillField(t.autoFillContext,i[n].field_name,r));s.site_address=s.site_street_number+" "+s.site_route}}}();