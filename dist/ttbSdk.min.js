!function(){"use strict";var defaults,methodsMapping;defaults={partnerKey:"1-234-567-890",sponsor:{name:"direct",title:"Benutech",TOSURL:"https://direct.api.titletoolbox.com/pages/tos/direct_tos"},baseURLPattern:"https://{{sponsorName}}.api.titletoolbox.com/",debug:!1,sdkPrefix:"ttb-sdk",autoFillAttr:"data-ttb-field",modalTemplate:['<div id={{modalId}} class="ttb-sdk-modal modal" role="dialog">',' <div class="modal-dialog {{sizeClass}}">','  <div class="modal-content">','   <div class="modal-header">','    <button type="button" class="close" data-dismiss="modal" title="Close">&times;</button>','    <h4 class="modal-title">{{title}}</h4>',"   </div>",'   <div class="modal-body">',"    {{bodyContent}}","   </div>","  </div>"," </div>","</div>"].join("")},methodsMapping={LOGIN:{methodName:"login",endpoint:"webservices/login.json"},LOGIN_REMOTE:{methodName:"loginRemote",endpoint:"webservices/remote_login.json"},LOGOUT:{methodName:"logout",endpoint:"webservices/logout.json"},GET_SPONSORS:{methodName:"TTB.getSponsors",endpoint:"webservices/get_sponsors.json"},SEARCH_PARCEL:{methodName:"searchByParcelNumber",endpoint:"webservices/search_parcel_number.json"},SEARCH_PROPERTY:{methodName:"searchBySiteAddress",endpoint:"webservices/search_property/ttb.json"},SEARCH_OWNER:{methodName:"searchByOwnerName",endpoint:"webservices/search_owner_name/ttb.json"},ORDER_REPORT:{methodName:"orderReport",endpoint:"webservices/order_report.json"},PROPERTY_COMPS:{methodName:"propertyComps",endpoint:"webservices/property_comps.json"},PROPERTY_DETAILS:{methodName:"propertyDetails",endpoint:"webservices/property_details.json"},GLOBAL_SEARCH:{methodName:"globalSearch",endpoint:"webservices/global_search.json"},GLOBAL_SEARCH_COUNT:{methodName:"globalSearchCount",endpoint:"webservices/global_search_count.json"},GET_TYPES_REPORT:{methodName:"getTypesReport",endpoint:"webservices/types_report.json"},GET_SEARCH_FIELDS:{methodName:"getSearchFields",endpoint:"webservices/get_search_fields.json"}},window.TTB=function(e){this.config=e,this.baseURLPattern=e.baseURLPattern||defaults.baseURLPattern,this.sponsor=e.sponsor||defaults.sponsor,this.baseURL=e.baseURL||this.setSponsor(this.sponsor),this.autoFillAttr=e.autoFillAttr||defaults.autoFillAttr,this.debug=e.debug||defaults.debug,this._log([defaults.sdkPrefix+" :","TTB SDK instantiated. | version: ",window.TTB.version])},window.TTB.version="0.11.0",window.TTB._createDefaultInstance=function(){return new TTB({partnerKey:defaults.partnerKey})},window.TTB._getLocal=function(e){var t=window.localStorage.getItem(defaults.sdkPrefix+"--"+e);return JSON.parse(t)},window.TTB._setLocal=function(e,t){window.localStorage.setItem(defaults.sdkPrefix+"-"+e,JSON.stringify(t))},window.TTB._modal=function(e){var t,o;return e.id=e.id||defaults.sdkPrefix+"--"+Date.now(),e.sizeClass=e.sizeClass||"modal-lg",o=defaults.modalTemplate.replace("{{modalId}}",e.id).replace("{{sizeClass}}",e.sizeClass).replace("{{title}}",e.title).replace("{{bodyContent}}",e.bodyContent),t=$(o).appendTo(document.body),e.onBeforeShow&&t.on("show.bs.modal",e.onBeforeShow),e.onShown&&t.on("shown.bs.modal",e.onShown),e.onBeforeClose&&t.on("hide.bs.modal",e.onBeforeClose),e.onClose&&t.on("hidden.bs.modal",e.onClose),t},window.TTB.utilIframeModal=function(e,t){var o,n;return t.height=t.height||"600px",(n={}).src=t.origin+t.pathname+"?hostOrigin={{hostOrigin}}".replace("{{hostOrigin}}",window.location.origin),t.params&&$.each(t.params,function(e,t){n.src+=t?"&"+e+"="+t:""}),n.iframeTemplate=['<iframe src="{{src}}" id="{{iframeId}}" name="{{iframeId}}" width="100%" height="{{height}}"></iframe>'].join("").replace("{{src}}",n.src).replace("{{height}}",t.height).replace("/{{iframeId}}/g",t.id),t.onMessage&&(window.addEventListener("message",s,!1),n.modalOptionsOnClose=e.onClose,e.onClose=function(){n.modalOptionsOnClose&&n.modalOptionsOnClose(),window.removeEventListener("message",s)}),e.bodyContent=n.iframeTemplate,(o=window.TTB._modal(e)).modal({}),o;function s(e){e.origin===t.origin&&t.onMessage(e.data,e)}},window.TTB.getSponsors=function(e){var t=window.TTB._createDefaultInstance(),o={method:"POST",data:JSON.stringify(e)};return t._ajax(o,methodsMapping.GET_SPONSORS)},window.TTB.showSelectSponsor=function(e,t){var o,n;return o="ttb-sdk-sponsor-selector",$("#"+o).length&&$("#"+o).remove(),n=this._modal({id:o,title:"Please select a Company to Partner with on your Data Integration:",bodyContent:"Retrieving list of all available Companies ..."}),TTB.getSponsors(e).done(function(s){var a;a={sponsorsData:void 0,bodyTemplate:void 0,bodyMarkup:void 0,sponsorTemplate:void 0,sponsorMarkup:void 0,sponsorsEmailMarkup:void 0,sponsorsZipMarkup:void 0,resultsMessage:void 0,tempTargetList:void 0},"OK"===s.response.status?(a.sponsorsData=s.response.data,a.bodyMarkup=[],a.sponsorsEmailMarkup=[],a.sponsorsZipMarkup=[],a.sponsorsOtherMarkup=[],a.sponsorTemplate=["<tr>"," <td>{{count}}</td>",' <td><img src="{{logoUrl}}" class="img-responsive" alt="Sponsor Logo"></td>'," <td>{{name}}</td>",' <td><a href="{{website}}" target="_blank">{{website}}</a></td>',' <td><button class="btn btn-primary pull-right" data-sponsor-name="{{sponsorName}}" data-sponsor-title="{{sponsorTitle}}" data-sponsor-tos="{{sponsorTOSURL}}">Select</button></td>',"</tr>"].join(""),a.bodyTemplate=["<p>{{resultsMessage}}</p>",'<div class="table-responsive">','<table class="table table-striped">',"<thead>","<tr>","<th>#</th>","<th>LOGO</th>","<th>NAME</th>","<th>WEBSITE</th>","<th></th>","</tr>","<thead>","<tbody>{{sponsorsMarkup}}</tbody>","<table>","</div>"].join(""),$.each(a.sponsorsData,function(e,t){switch(a.sponsorMarkup=a.sponsorTemplate.replace("{{logoUrl}}",t.company_info.logo_url).replace("{{name}}",t.company_info.company_name).replace(/(\{\{website}})/g,t.company_info.company_website).replace("{{sponsorName}}",t.vertical_name).replace("{{sponsorTitle}}",t.company_info.company_name).replace("{{sponsorTOSURL}}",t.TOS_content),t.match.type){case"email":a.tempTargetList=a.sponsorsEmailMarkup;break;case"zip":a.tempTargetList=a.sponsorsZipMarkup;break;case null:a.tempTargetList=a.sponsorsOtherMarkup;break;default:return void console.log("showSelectSponsor: unknown sponsor.match.type: ",t.match.type)}a.sponsorMarkup=a.sponsorMarkup.replace("{{count}}",a.tempTargetList.length+1),a.tempTargetList.push(a.sponsorMarkup)}),a.sponsorsEmailMarkup.length&&(a.resultsMessage="It appears you currently partner with the following Companies ...",a.bodyMarkup.push(a.bodyTemplate.replace("{{resultsMessage}}",a.resultsMessage).replace("{{sponsorsMarkup}}",a.sponsorsEmailMarkup.join("")))),a.sponsorsZipMarkup.length&&(a.sponsorsEmailMarkup.length&&a.bodyMarkup.push("<hr>"),a.resultsMessage="The following Companies are available Partners in the <strong>{{zipCode}}</strong> Zip Code.".replace("{{zipCode}}",e.zipCode),a.bodyMarkup.push(a.bodyTemplate.replace("{{resultsMessage}}",a.resultsMessage).replace("{{sponsorsMarkup}}",a.sponsorsZipMarkup.join("")))),!a.sponsorsOtherMarkup.length||a.sponsorsZipMarkup.length||a.sponsorsEmailMarkup.length||(1===a.sponsorsData.length&&"leads"===a.sponsorsData[0].vertical_name?a.resultsMessage=["There is currently not a Company as a participating Partner in Zip Code <strong>{{zipCode}}</strong>. ","The Data will be proudly supplied by Benutech Inc."].join("").replace("{{zipCode}}",e.zipCode):a.resultsMessage="The following Companies are available Partners.",a.bodyMarkup.push(a.bodyTemplate.replace("{{resultsMessage}}",a.resultsMessage).replace("{{sponsorsMarkup}}",a.sponsorsOtherMarkup.join("")))),n.find(".modal-dialog").css({width:"760px"}).find(".modal-body").html(a.bodyMarkup.join("")),$("#"+o+" tbody").on("click","button",function(e){var o={name:$(this).attr("data-sponsor-name"),title:$(this).attr("data-sponsor-title"),TOSURL:$(this).attr("data-sponsor-tos")};t.onSelect&&t.onSelect(o),n.modal("hide")})):t.onError&&t.onError(s)}).fail(function(e){n.find(".modal-body").html("Failed in retrieving list."),t.onError&&t.onError(e)}),n.modal({})},window.TTB.prototype={_log:function(e){this.config.debug&&console.log.apply(console,e)},_fillFields:function(selector,data,clearExisting,delay){var _self,$fields,model,modelValue,fillValue,timeout;_self=this,$fields=$(selector).find("input["+_self.autoFillAttr+"]"),delay?(timeout=0,fillValue=function(e,t){timeout+=delay,setTimeout(function(){e.val(t)},timeout)}):fillValue=function(e){$(this).val(e)},$fields.each(function(){model=$(this).attr(_self.autoFillAttr),clearExisting&&$(this).val(void 0);try{modelValue=eval("data."+model),modelValue&&fillValue($(this),modelValue)}catch(e){_self._log([defaults.sdkPrefix," : autoFill : ",model,": skipping - invalid model"])}})},_fillField:function(e,t,o){var n;(n=$(e).find("input["+this.autoFillAttr+'="'+t+'"]')).length?n.val(o):this._log([defaults.sdkPrefix," : autoFill : skipping : field not found - ",t])},_ajax:function(e,t,o){var n,s;return n=this,e.url=e.url||this.baseURL+t.endpoint,e.url=o?e.url+"?"+$.param(o):e.url,s=$.extend(e,{headers:{"Partner-Key":this.config.partnerKey,"Third-Party":!0},xhrFields:{withCredentials:!0}}),$.ajax(s).done(function(e){return"string"==typeof e||e instanceof Array||"OK"===e.response.status?n._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": success :",e]):n._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": error :",e]),e}).fail(function(e){return n._log([defaults.sdkPrefix+" :",t.methodName+"() [",t.endpoint,"]",": fail :",e]),401===e.status&&n.config.onSessionExpire&&n.config.onSessionExpire({requestConfig:s,requestError:e,methodName:t.methodName,endpoint:t.endpoint,retry:function(){return $.ajax(s)}}),e})},setSponsor:function(e){return this.sponsor=e,this.baseURL=this.baseURLPattern.replace("{{sponsorName}}",e.name)},showTOS:function(){var e,t;return e="ttb-sdk-sponsor-tos",$("#"+e).length&&$("#"+e).remove(),t=['<iframe src="{{src}}" width="100%" height="600px"></iframe>',"</div>"].join("").replace("{{src}}",this.sponsor.TOSURL),window.TTB._modal({id:e,title:"Terms of Service",bodyContent:t}).modal({})},loginRemote:function(e){e.sso=!1;var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.LOGIN_REMOTE)},login:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.LOGIN)},logout:function(){return this._ajax({method:"GET"},methodsMapping.LOGOUT)},searchByParcelNumber:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_PARCEL)},searchBySiteAddress:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_PROPERTY)},searchByOwnerName:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.SEARCH_OWNER)},orderReport:function(e){e.output=e.output||"link",e.report_type=e.report_type||"property_profile";var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.ORDER_REPORT)},propertyComps:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.PROPERTY_COMPS)},propertyDetails:function(e,t){var o;o=this,t=t||{autoFillContext:null};var n={method:"POST",data:JSON.stringify(e)};return this._ajax(n,methodsMapping.PROPERTY_DETAILS).then(function(e){return t.autoFillContext&&o._fillFields(t.autoFillContext,e.response.data,t.autoFillClearExisting,t.autoFillDelay),e})},globalSearch:function(e,t){var o={method:"POST",data:JSON.stringify(e)};return this._ajax(o,methodsMapping.GLOBAL_SEARCH,t)},globalSearchCount:function(e){var t={method:"POST",data:JSON.stringify(e)};return this._ajax(t,methodsMapping.GLOBAL_SEARCH_COUNT)},nearbySearch:function(e,t){var o={limit:e.limit||1e3,page:1},n={mm_fips_state_code:e.mm_fips_state_code,use_code_std:["RSFR","RCON"],customFilters:{},searchOptions:{max_limit:e.limit||void 0},geometry:{match:"circle",value:{center_lat:e.center_lat,center_lng:e.center_lng,radius:e.radius}}};n=$.extend(n,t);var s={method:"POST",data:JSON.stringify(n)};return this._ajax(s,methodsMapping.GLOBAL_SEARCH,o)},getTypesReport:function(){return this._ajax({method:"GET"},methodsMapping.GET_TYPES_REPORT)},getSearchFields:function(){return this._ajax({method:"GET"},methodsMapping.GET_SEARCH_FIELDS)},googleBuildAddress:function(e,t){var o,n,s,a,i,r;n={},r={street_number:{field_name:"site_street_number",name_type:"short_name"},route:{field_name:"site_route",name_type:"short_name"},locality:{field_name:"site_city",name_type:"long_name"},neighborhood:{field_name:"site_neighborhood",name_type:"long_name"},administrative_area_level_1:{field_name:"site_state",name_type:"short_name"},administrative_area_level_2:{field_name:"site_county",name_type:"short_name"},postal_code:{field_name:"site_zip",name_type:"short_name"}};for(var l=0,d=(o=e.getPlace()).address_components.length;l<d;l++)r[a=(s=o.address_components[l]).types[0]]&&(i=s[r[a].name_type],n[r[a].field_name]=i,t&&t.autoFillContext&&this._fillField(t.autoFillContext,r[a].field_name,i));return(n.site_street_number||n.site_route)&&(n.site_address=(n.site_street_number||"")+(n.site_street_number&&n.site_route?" ":"")+(n.site_route||"")),n.site_county=n.site_county.replace(" County",""),n},instantLookupWidget:function(e,t){var o,n,s;if(s=this,t=t||{},(o={}).selectedAction=window.TTB._getLocal("selectedAction",o.selectedAction)||{name:"fullProfileReport",label:"Full Profile Report"},o.widgetClass="ttb-sdk--instant-lookup--container",o.widgetTemplate=["\x3c!-- the google autocomplete address lookup --\x3e",'<div id="ttb-sdk--instant-lookup--address" class="col-xs-7">',' <div class="">','  <input type="text" class="form-control" id="ttb-sdk--instant-lookup--auto-complete" name="ttb-sdk--instant-lookup--auto-complete" placeholder="Search for an address...">'," </div>","</div>","\x3c!-- actions menu --\x3e",'<div id="ttb-sdk--instant-lookup--actions" class="col-xs-5">',' <i class="async loading spinner"></i>'," \x3c!-- Split button --\x3e",' <div class="btn-group" dropdown="">',"  \x3c!-- dynamic placeholder to contain last selected action --\x3e",'  <button type="button" id="ttb-sdk--instant-lookup--selected-action" class="btn btn-default">{{selectedActionLabel}}</button>','  <button type="button" class="btn btn-default dropdown-toggle" data-dropdown-toggle="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">','  <span class="caret"></span>','  <span class="sr-only">Toggle Dropdown</span>',"  </button>",'  <ul class="dropdown-menu">','  <li><a data-action-name="fullProfileReport" href="javascript:">Full Profile Report</a></li>',"  </ul>","</div>","</div>"].join("").replace("{{selectedActionLabel}}",o.selectedAction.label),o.$container=$(e),!o.$container.length)return this._log([defaults.sdkPrefix," : instantLookupWidget : abort : element not found - ",e]),null;o.$container.addClass(o.widgetClass).append(o.widgetTemplate);try{google.maps.places.Autocomplete}catch(e){this._log([defaults.sdkPrefix,' : instantLookupWidget : abort : "google.maps.places.Autocomplete" not found -'," please make sure the google script was loaded and that instantLookupWidget() is being called inside/after google load cb is "," called i.e. googleInit() or the mentioned callback=* in the google script src value."])}function a(){var a,i;o.selectedAddressInfo?(a=function(){t[o.selectedAction.name]&&t[o.selectedAction.name]()},n.$element.prop("disabled",!0),o.$selectedAction.prop("disabled",!0).next("button").prop("disabled",!0),i=function(){n.$element.prop("disabled",!1),o.$selectedAction.prop("disabled",!1).next("button").prop("disabled",!1)},s.searchBySiteAddress(o.selectedAddressInfo).then(function(t){var n;if(s._log([defaults.sdkPrefix," : instantLookupWidget : searchBySiteAddress - success - ",t]),"OK"===(t=t.response).status&&t.data&&t.data.length){if(t.data.length>1)return alert("Multiple records found, please refine your search to make it more specific."),t;switch(n=t.data[0],o.selectedAction.name){case"fullProfileReport":s._log([defaults.sdkPrefix," : instantLookupWidget : fullProfileReport"]),s.orderReport({sa_property_id:n.sa_property_id,state_county_fips:n.mm_fips_state_code+n.mm_fips_muni_code,report_type:"property_profile",output:"link"}).then(function(e){window.open(e.response.data.report.link)},function(e){alert("Failed in getting full profile report.")}).always(function(){i()});break;default:s._log([defaults.sdkPrefix," : instantLookupWidget : action not found - ",e]),i()}}else a(),i()},function(){a(),i()})):n.$element.focus()}(n={}).$element=o.$container.find("#ttb-sdk--instant-lookup--auto-complete"),n.instance=new google.maps.places.Autocomplete(n.$element[0],{types:["geocode"]}),n.instance.addListener("place_changed",function(){o.selectedAddressInfo=s.googleBuildAddress(n.instance)}),o.$selectedAction=o.$container.find("#ttb-sdk--instant-lookup--selected-action"),o.$selectedAction.on("click",a),o.$container.find("#ttb-sdk--instant-lookup--actions ul").on("click",function(e){t=e,o.selectedAction.name=$(t.target).data("action-name"),o.selectedAction.label=$(t.target).text(),o.$selectedAction.text(o.selectedAction.label),window.TTB._setLocal("selectedAction",o.selectedAction),a();var t})},connectWidget:function(e,t){var o,n;if(n=this,t=t||{},(o={}).selectedSponsor=window.TTB._getLocal("connect--selectedSponsor",o.selectedAction),o.widgetClass="ttb-sdk--connect--container",o.widgetTemplate=['<div id="ttb-sdk--connect--connect-section" class="row">',' <div class="col-xs-12">','  <button class="btn btn-primary pull-right">Connect</button>'," </div>","</div>","\x3c!-- hidden by default --\x3e",'<div id="ttb-sdk--connect--disconnect-section" class="row" style="display: none;">',' <div class="col-xs-4">',"  <strong>Title company</strong>"," </div>"," \x3c!-- to be dynamically updated --\x3e",' <div id="ttb-sdk--connect--company-name" class="col-xs-4">',"  Lorem Ipsum Company"," </div>",' <div class="col-xs-4">','  <button class="btn btn-danger pull-right">Disconnect</button>'," </div>","</div>"].join(""),o.$container=$(e.elementSelector),!o.$container.length)return this._log([defaults.sdkPrefix," : connectWidget : abort : element not found - ",e.elementSelector]),null;o.$container.addClass(o.widgetClass).append(o.widgetTemplate),o.selectedSponsor&&o.$container.find("#ttb-sdk--connect--connect-section").hide().find("#ttb-sdk--connect--disconnect-section").show().find("#ttb-sdk--connect--company-name").text(o.selectedSponsor.title),o.$container.find("#ttb-sdk--connect--connect-section button").on("click",function(){var t,o;t={id:"ttb-sdk--connect--modal",title:"Connect with TitleToolbox"},o={id:"ttb-sdk--connect--iframe",height:"600px",origin:"http://ttb-landing-page.herokuapp.com",pathname:"/index.html",params:{stk:e.loginRemotePayload.stk,getuser_url:e.loginRemotePayload.getuser_url,partnerKey:n.config.partnerKey},onMessage:function(e,t){n._log(["connectWidget: onMessage",e,t])}},window.TTB.utilIframeModal(t,o)})}}}();